{% extends "base.html" %}

{% block title %}Chat{% endblock %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-body">
        <h3 class="mb-3">๐ฌ Arabic RAG Chat</h3>

        <p class="text-muted">
            ุงูุชุจ ุณุคุงูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุณูููู ุงููุธุงู ุจุงูุฅุฌุงุจุฉ ุงุนุชูุงุฏูุง ุนูู ูุงุนุฏุฉ ุงููุนุฑูุฉ.
        </p>

        <!-- Question input -->
        <div class="mb-3">
            <label class="form-label">ุณุคุงูู</label>
            <textarea
                id="question"
                class="form-control"
                rows="3"
                placeholder="ุงูุชุจ ุณุคุงูู ููุง..."
            ></textarea>
        </div>

        <button id="ask-btn" class="btn btn-primary">
            ุงุณุฃู
        </button>
        
        <div class="mt-4">
            <h5>ุงูุฅุฌุงุจุฉ</h5>
            <div id="answer-box" class="border rounded p-3 bg-light text-muted">
                ูู ูุชู ุฅุฑุณุงู ุฃู ุณุคุงู ุจุนุฏ
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
    const askBtn = document.getElementById("ask-btn");
    const questionInput = document.getElementById("question");
    const answerBox = document.getElementById("answer-box");
    
    askBtn.addEventListener("click", async () => {
        const question = questionInput.value.trim();
    
        if (!question) {
            answerBox.innerHTML = "ุงูุฑุฌุงุก ูุชุงุจุฉ ุณุคุงู ุจุงููุบุฉ ุงูุนุฑุจูุฉ";
            return;
        }
    
        askBtn.disabled = true;
        answerBox.classList.remove("text-muted");
        answerBox.innerHTML = " ุฌุงุฑู ุงูุจุญุซ ุนู ุงูุฅุฌุงุจุฉ...";
    
        try {
            const res = await fetch("/api/ask/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-API-KEY": "yafahala2810khkh"
                },
                body: JSON.stringify({
                    question: question
                })
            });
    
            const data = await res.json();
    
            if (!res.ok) {
                throw new Error(data.error || "ูุดู ูู ุงูุฅุฌุงุจุฉ");
            }
    
            answerBox.innerHTML = data.answer || "โ๏ธ ูู ูุชู ุฅุฑุฌุงุน ุฅุฌุงุจุฉ";
    
        } catch (err) {
            answerBox.innerHTML = err.message;
        } finally {
            askBtn.disabled = false;
        }
    });
    </script>
    {% endblock %}
    